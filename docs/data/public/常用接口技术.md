## 并行通信

并行：指多比特数据同时通过并行线进行传送，这样数据传送速度大大提高，但并行传送的线路长度受到限制，因为长度增加，干扰就会增加，数据也就容易出错。

特点：

1. 以数据字节或字为单位进行数据传送，两个功能模块间有多位数据同时进行数据传送，速度快、效率高。
2. 适合近距离传送
3. 8位、16位和4字节的数据是同时传送的
4. 并行传送的信息不要求固定格式要求

#### 并行接口的类型

1）数据传送的方向

- 输入接口 --- 必须具有对数据的控制能力
- 输出接口 --- 必须具有对数据的锁存能力

2）传输数据的形式

- 单向传送接口
- 双向传送接口

3）电路结构

- 简单接口(或硬接线接口)
- 可编程接口

4）传送信息的类型

- 数字接口
- 模拟接口

### 串行通信

串行通信是指计算机主机与外设之间以及主机系统与主机系统之间数据的串行传送。使用一条数据线，将数据一位一位地依次传输，每一位数据占据一个固定的时间长度。其只需要少数几条线就可以在系统间交换信息，特别适用于计算机与计算机、计算机与外设之间的远距离通信。

## 可编程定时/计数器8253

### 引脚

1）D~0~ ~ D~7~：8位双向数据线。用来传送数据、控制字和计数器初值。

2）$\overline{CS}$ ：片选信号

3）$\overline{RD}$：读控制信号

4）$\overline{WR}$ ：写控制信号

5）A~0~ 、A~1~：地址信号线。经译码产生4个有效地址，对应芯片内部3个独立的计数器(通道)和一个控制寄存器。

| A~1~ | A~0~ | 功能           |
| ---- | ---- | -------------- |
| 0    | 0    | 选择计数器0    |
| 0    | 1    | 选择计数器1    |
| 1    | 0    | 选择计数器2    |
| 1    | 1    | 选择控制寄存器 |

6）CLK~0~ ~ CLK~2~：每个计数器的时钟信号输入端，计数器对此时种信号进行计数。

7）GATE~0~ ~ GATE~2~：门控信号，用于控制计数的启动和停止

8）OUT~0~ ~ OUT~2~：计数器输出信号

### 内部结构和工作原理

主要包括3个计数器、一个控制计数器以及数据总线缓冲器和读/写逻辑电路。

1）计数器

减值计数器，最大为 0000H

计数器0(CNT~0~)、计数器1(CNT~1~) 和 计数器(CNT~2~)是3个相同的16位计数器，都包括一个16位的初值寄存器、一个计数执行单元和一个输出锁存器。每一个

2）控制寄存器

用来存放控制字的，控制字在8253初始化时通过输出指令写入控制寄存器，该寄存器为8位，只能写入，不能读出。

3）数据总线缓冲器

是一个8位的双向三态缓冲器，CPU通过该数据缓冲器对8253进行读写

4）读写控制逻辑

### 计数启动方式

由程序指令启动，称为软件启动；由外部电路信号启动，称为硬件启动。

不自动重复计数特点：每写入一次计数初值只计数一个周期，若要重新计数，需CPU再次写入计数初值。

### 工作方式

可以通过时序图来记忆

#### 1. 方式0 --- 计数结束中断

软件启动、不自动重复计数的方式。

#### 2. 方式1 --- 可重复触发的单稳态触发器

硬件启动、不自动重复计数的方式。

#### 3. 方式2 --- 频率发生器

软/硬件启动、   自动重复计数的方式。

#### 4. 方式3 --- 方波发生器

硬件启动、不自动重复计数的方式。

#### 5. 方式4 --- 软件触发选通

硬件启动、不自动重复计数的方式。

#### 6. 方式5 --- 硬件触发选通

硬件启动、不自动重复计数的方式。

| 工作方式 | 启动计数 | 中止计数 | 自动重复 | 更新初值   | 输出波形                                 |
| -------- | -------- | -------- | -------- | ---------- | ---------------------------------------- |
| 0        | 软件     | GATE=0   | 否       | 立即有效   | 延迟时间可变的上升沿                     |
| 1        | 硬件     | /        | 否       | 下一轮有效 | 宽度为N*T~CLK~的单一负脉冲               |
| 2        | 软/硬件  | GATE=0   | 是       | 下一轮有效 | 周期为N*T~CLK~，宽度为T~CLK~的连续负脉冲 |
| 3        | 软/硬件  | GATE=0   | 是       | 下一轮有效 | 周期为N*T~CLK~的连续方波                 |
| 4        | 软件     | GATE=0   | 否       | 立即有效   | 宽度为T~CLK~的单一负脉冲                 |
| 5        | 硬件     | /        | 否       | 下一轮有效 | 宽度为T~CLK~的单一负脉冲                 |

注：更新初值---是指正在计数时更新计数初值。



### 控制字

D~7~  -- D~6~ 计数器选择：00 计数器0，01 计数器1， 10 计数器2， 11 无效

D~5~  -- D~4~ 计数长度选择： 00 将计数器中的数据锁存于缓冲器，01 只读/写计数器低8位，10 只读/写计数器高8位， 11 只读/写计数器低8位， 再读/写计数器高8位。

D~3~  -- D~1~ 工作方式选择：000 方式0，001 方式1，x10 方式2， x11 方式3， 100 方式4，101方式5.

D~0~ 计数制选择：1 BCD计数，0  二进制计数。

**注**：

- 计数长度选择的00：在8253计数过程中，CPU可随时读出其当前的计数值，而不影响计数器工作。
- 计数长度选择的01和10：写入一个字节，另一个字节8253默认为0。（在有些地方可以省点力气）

### 编程

对8253有两种初始化方法

1. 先写控制字， 再写初值，再写控制字，以此循环
2. 先写计数器0控制字， 再写计数器1控制字， 再写计数器0初值， 再计数器1初值

## 可编程并行接口8255

### 引线及结构

#### 1. 外部结构及结构

1）D~0~ ~ D~7~：双向数据信号线，传送数据和控制字。

2）$\overline{RD}$：读信号线

3）$\overline{WR}$：写信号线

4）$\overline{CS}$：片选信号

5）A~0~、A~1~ ：口地址选择信号线

| A~1~ | A~0~ | 选择 | A~1~ | A~0~ | 选择       |
| ---- | ---- | ---- | ---- | ---- | ---------- |
| 0    | 0    | A口  | 1    | 0    | C口        |
| 0    | 1    | B口  | 1    | 1    | 控制寄存器 |

6）RESET：复位输入信号，复位后，A口、B口、C口均被预设为输入状态。

7）PA~0~ ~ PA~7~：A口的8条输入/输出信号线 ，由软件决定工作在输入、输出还是双向(同时为输入或输出)。

8）PB~0~ ~ PB~7~：B口的8条输入/输出信号线，由软件决定工作在输入、输出。

9）PC~0~ ~ PC~7~：C口，可作为数据的输入或输出线，也可以用作控制信号的输出或状态信号的输入线。

#### 内部结构

1）数据端口

A口和B口的输入/输出都具有数据锁存能力，C口输出有锁存能力，而输入没有锁存能力。

C口特点：可以对其按位进行操作。

2）A组和B组控制电路

3）读写控制逻辑

4）数据总线缓冲器

三态双向8位数据缓冲器

### 工作方式

#### 1. 工作方式0（适用于无条件和查询方式）

又称为基本输入/输出方式

A口, C口的高四位，B口，C口的低四位可分别定义为输入或输出. 共16种组合。

#### 2. 工作方式1 （适用于中断和查询方式）

又称为选通输入/输出方式

A口和B口作为数据的输出口和输入口，其中利用C口作为选通信号。

1）输出（接口输出到外设）

系统在IOW信号有效期间将数据输入到A端口或B端口。

输出缓冲器满信号$\overline{OBF}$通知外设。

外设从端口取走数据后，发出响应信号$\overline{ACK}$，同时$\overline{OBF}$ = 1.

$\overline{ACK}$ 的上升沿产生有效的INTR信号（INTR 的产生条件$\overline{OBF}$ = 1，$\overline{ACK}$ = 1, INTE=1）

注：INTE 是否输出高电平由$\overline{ACK}$信号决定。

2）输入（外设输入到接口）

外设发出$\overline{STB}$信号，并在$\overline{STB}$有效期间将数据锁存于8255的输入缓冲器中。

缓冲器满后，接口发出高电平有效的IBF信号，它作为$\overline{STB}$的应答信号

$\overline{STB}$ = 1时会使内部中断触发器INTE和IBF均为高电平，产生INTR信号

注：INTE 可以利用C口位操作方式的置位/复位来控制。

#### 3. 工作方式2  （适用于中断和查询方式和需要双向传送数据的外设）

又称为双向传输方式， 只有A口可以工作在方式2下

### 控制字

D~7~ : 0 位操作， 1 方式操作

**1）方式控制字**

D~7~ : 1

D~6~ - D~5~ :  

A组方式选择 00 方式0， 01 方式1， 1x方式2

D~4~ : A口：0 输出， 1输入

D~3~: C口高4位：0 输出， 1输入

D~2~: B组方式选择：0 方式0， 1 方式1

D~3~: B口：0 输出， 1输入

D~0~: C口低4位：0 输出， 1输入

**2）按位操作控制字**

D~7~ : 0

D~6~ - D~4~: xxx

D~3~ - D~1~ : 

C口的位选择： 000 - PC~0~  -----    111 - PC~7~

D~0~:  0 - 复位， 1 -  置位

### 状态字

状态字反映了C端口各位当前的状态。

1）A, B口为方式1输入时的状态字

| a    |      |      |      | a    | b    |      | b    |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| D~7~ |      |      |      | D~3~ | D~2~ |      | D~0~ |
| I/O  | I/O  | IBF  | INTE | INTR | INTE | IBF  | INTR |

2）A, B口为方式1输出时的状态字

| a                |      |      |      | a    | b    |                  | b    |
| ---------------- | ---- | ---- | ---- | ---- | ---- | ---------------- | ---- |
| D~7~             |      |      |      | D~3~ | D~2~ |                  | D~0~ |
| $\overline{OBF}$ | INTE | I/O  | I/O  | INTR | INTE | $\overline{OBF}$ | INTR |

2）A, B口为方式1输出时的状态字

| a                |      |      |      | a    | b    |                | b    |
| ---------------- | ---- | ---- | ---- | ---- | ---- | :------------- | ---- |
| D~7~             |      |      |      | D~3~ | D~2~ |                | D~0~ |
| $\overline{OBF}$ | INTE | IBF  | INTE | INTR |      | 由工作方式决定 |      |

 